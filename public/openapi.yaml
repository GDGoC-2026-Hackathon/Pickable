openapi: 3.0.3
info:
  title: Pickable API
  description: 회원가입·인증·채용공고 API 명세 (NextAuth 세션 쿠키 인증)
  version: 0.2.0

servers:
  - url: /
    description: 상대 경로 (프론트와 동일 오리진)

tags:
  - name: Health
    description: 서버 상태
  - name: Auth
    description: 인증·현재 사용자
  - name: Signup
    description: 역할 선택 및 회원가입
  - name: JobPostings
    description: 채용 공고 (목록 조회 · 상세 조회 · 생성)

paths:
  /api/health:
    get:
      tags: [Health]
      summary: 헬스 체크
      responses:
        "200":
          description: 정상
          content:
            application/json:
              schema:
                type: object
                properties:
                  status: { type: string, example: ok }
                  timestamp: { type: string, format: date-time }

  /api/auth/me:
    get:
      tags: [Auth]
      summary: 현재 로그인 사용자
      security: [sessionCookie: []]
      responses:
        "200":
          description: 성공
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      id: { type: string }
                      name: { type: string, nullable: true }
                      email: { type: string, nullable: true }
                      image: { type: string, nullable: true }
        "401":
          $ref: "#/components/responses/Unauthorized"

  /api/signup/status:
    get:
      tags: [Signup]
      summary: 가입 상태 조회
      description: 역할 선택 여부(role), 프로필/기업 등록 여부(hasProfile)
      security: [sessionCookie: []]
      responses:
        "200":
          description: 성공
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      role:
                        type: string
                        enum: [JOB_SEEKER, CORPORATION]
                        nullable: true
                      hasProfile: { type: boolean }
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          $ref: "#/components/responses/UserNotFound"
        "500":
          $ref: "#/components/responses/DBError"

  /api/signup/role:
    post:
      tags: [Signup]
      summary: 역할 선택
      description: 로그인 후 1회만 설정 가능 (JOB_SEEKER | CORPORATION)
      security: [sessionCookie: []]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [role]
              properties:
                role:
                  type: string
                  enum: [JOB_SEEKER, CORPORATION]
      responses:
        "201":
          description: 생성됨
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      id: { type: string }
                      role: { type: string, enum: [JOB_SEEKER, CORPORATION] }
        "400":
          $ref: "#/components/responses/ValidationError"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "409":
          description: 이미 역할 설정됨
          content:
            application/json:
              schema: { $ref: "#/components/schemas/Error" }
              example:
                error: { code: ROLE_ALREADY_SET, message: "이미 역할이 설정되어 있습니다." }
        "500":
          $ref: "#/components/responses/DBError"

  /api/signup/job-seeker:
    post:
      tags: [Signup]
      summary: 취준생 프로필 등록
      description: role=JOB_SEEKER인 사용자만, 1회 등록
      security: [sessionCookie: []]
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: "#/components/schemas/JobSeekerSignup" }
      responses:
        "201":
          description: 생성됨
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      id: { type: string }
                      createdAt: { type: string, format: date-time }
        "400":
          $ref: "#/components/responses/ValidationError"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "422":
          description: 역할 미선택 또는 역할 불일치
          content:
            application/json:
              schema: { $ref: "#/components/schemas/Error" }
        "409":
          description: 이미 프로필 등록됨
          content:
            application/json:
              schema: { $ref: "#/components/schemas/Error" }
              example:
                error: { code: PROFILE_ALREADY_EXISTS, message: "이미 프로필이 등록되어 있습니다." }
        "500":
          $ref: "#/components/responses/DBError"

  /api/signup/corporation:
    post:
      tags: [Signup]
      summary: 기업 등록
      description: role=CORPORATION인 사용자만, 1회 등록
      security: [sessionCookie: []]
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: "#/components/schemas/CorporationSignup" }
      responses:
        "201":
          description: 생성됨
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      id: { type: string }
                      name: { type: string }
                      createdAt: { type: string, format: date-time }
        "400":
          $ref: "#/components/responses/ValidationError"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "422":
          description: 역할 미선택 또는 역할 불일치
          content:
            application/json:
              schema: { $ref: "#/components/schemas/Error" }
        "409":
          description: 이미 기업 등록됨
          content:
            application/json:
              schema: { $ref: "#/components/schemas/Error" }
              example:
                error: { code: PROFILE_ALREADY_EXISTS, message: "이미 기업이 등록되어 있습니다." }
        "500":
          $ref: "#/components/responses/DBError"

  # ──────────────────────────────────────
  # 채용 공고
  # ──────────────────────────────────────

  /api/job-postings:
    get:
      tags: [JobPostings]
      summary: 공고 목록 조회
      description: |
        채용 공고 목록을 페이지네이션으로 조회합니다.
        로그인한 취준생(JOB_SEEKER)의 경우 매칭률(matchRate)이 함께 반환됩니다.
        비로그인 사용자도 조회 가능합니다.
      parameters:
        - name: page
          in: query
          schema: { type: integer, default: 1, minimum: 1 }
          description: 페이지 번호
        - name: limit
          in: query
          schema: { type: integer, default: 10, minimum: 1, maximum: 50 }
          description: 페이지당 항목 수
        - name: status
          in: query
          schema: { type: string, enum: [OPEN, CLOSED] }
          description: 채용 상태 필터
      responses:
        "200":
          description: 성공
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items: { $ref: "#/components/schemas/JobPostingListItem" }
                  pagination:
                    $ref: "#/components/schemas/Pagination"
        "500":
          $ref: "#/components/responses/DBError"

    post:
      tags: [JobPostings]
      summary: 공고 생성
      description: |
        기업(CORPORATION) 역할의 사용자만 호출 가능.
        기업 등록(Corporation)이 완료된 상태여야 합니다.
      security: [sessionCookie: []]
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: "#/components/schemas/CreateJobPosting" }
      responses:
        "201":
          description: 생성됨
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: object
                    properties:
                      id: { type: string }
                      title: { type: string }
                      status: { type: string, enum: [OPEN, CLOSED] }
                      createdAt: { type: string, format: date-time }
        "400":
          $ref: "#/components/responses/ValidationError"
        "401":
          $ref: "#/components/responses/Unauthorized"
        "404":
          description: 기업 정보 없음
          content:
            application/json:
              schema: { $ref: "#/components/schemas/Error" }
              example:
                error: { code: CORPORATION_NOT_FOUND, message: "기업 정보를 찾을 수 없습니다." }
        "422":
          description: 역할 미선택 또는 역할 불일치
          content:
            application/json:
              schema: { $ref: "#/components/schemas/Error" }
        "500":
          $ref: "#/components/responses/DBError"

  /api/job-postings/{id}:
    get:
      tags: [JobPostings]
      summary: 공고 상세 조회
      description: |
        특정 채용 공고의 상세 정보를 조회합니다.
        로그인한 취준생의 경우 매칭률이 함께 반환됩니다.
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: string }
          description: 공고 ID
      responses:
        "200":
          description: 성공
          content:
            application/json:
              schema:
                type: object
                properties:
                  data: { $ref: "#/components/schemas/JobPostingDetail" }
        "404":
          description: 공고 없음
          content:
            application/json:
              schema: { $ref: "#/components/schemas/Error" }
              example:
                error: { code: JOB_POSTING_NOT_FOUND, message: "채용 공고를 찾을 수 없습니다." }
        "500":
          $ref: "#/components/responses/DBError"

components:
  securitySchemes:
    sessionCookie:
      type: apiKey
      in: cookie
      name: authjs.session-token
      description: NextAuth 세션 쿠키 (로그인 후 자동 설정)

  schemas:
    Error:
      type: object
      properties:
        error:
          type: object
          properties:
            code: { type: string }
            message: { type: string }

    JobSeekerSignup:
      type: object
      required:
        - educationLevel
        - major
        - desiredJobRole
        - militaryStatus
        - birthDate
        - gender
      properties:
        educationLevel:
          type: string
          enum: [HIGH_SCHOOL, ASSOCIATE, BACHELOR, MASTER, DOCTORATE]
        major: { type: string }
        desiredJobRole: { type: string }
        militaryStatus:
          type: string
          enum: [NOT_APPLICABLE, COMPLETED, EXEMPT, SERVING, NOT_COMPLETED]
        desiredLocation: { type: string }
        desiredSalaryRange:
          type: string
          enum: [UNDER_2400, RANGE_2400_3000, RANGE_3000_3600, RANGE_3600_4200, RANGE_4200_5000, OVER_5000]
        commuteStart: { type: string, description: "HH:mm" }
        commuteEnd: { type: string, description: "HH:mm" }
        employmentType:
          type: string
          enum: [FULL_TIME, CONTRACT, INTERN, FREELANCE]
        birthDate: { type: string, format: date, description: "YYYY-MM-DD" }
        gender:
          type: string
          enum: [MALE, FEMALE, OTHER]
        skills:
          type: array
          items: { type: string }
        experiences:
          type: array
          items:
            type: object
            required: [type, title]
            properties:
              type: { type: string, enum: [ACTIVITY, AWARD, OVERSEAS, VOLUNTEER] }
              title: { type: string }
              description: { type: string }
              isJobRelated: { type: boolean, default: false }
        credentials:
          type: array
          items:
            type: object
            required: [type, name]
            properties:
              type: { type: string, enum: [CERTIFICATE, LANGUAGE] }
              name: { type: string }
              score: { type: string }

    CorporationSignup:
      type: object
      required: [name, industry, address, companySize]
      properties:
        name: { type: string }
        industry: { type: string }
        address: { type: string }
        companySize:
          type: string
          enum: [STARTUP, SMALL, MEDIUM, LARGE, ENTERPRISE]
        thumbnailUrl: { type: string }
        description: { type: string }
        welfare: { type: string }
        homepageUrl: { type: string }
        phone: { type: string }

    # ── 채용 공고 스키마 ──

    CreateJobPosting:
      type: object
      required: [title, jobTrack, minEducationLevel, militaryPolicy, careerPolicy]
      properties:
        title:
          type: string
          description: "뽑는 직무 (e.g. Front-end Engineer)"
        jobTrack:
          type: string
          description: "직무 트랙 (e.g. 기술/개발 트랙)"
        minEducationLevel:
          type: string
          enum: [HIGH_SCHOOL, ASSOCIATE, BACHELOR, MASTER, DOCTORATE]
          description: 필수 학력 요건
        militaryPolicy:
          type: string
          enum: [NOT_RELEVANT, REQUIRED, BONUS, NOT_REFLECTED]
          description: "병역 여부 (무관/필수/가산점 부여/미반영)"
        careerPolicy:
          type: string
          enum: [NOT_RELEVANT, REQUIRED, BONUS, NOT_REFLECTED]
          description: "직무 관련 경력 (무관/필수/가산점 부여/미반영)"
        deadline:
          type: string
          format: date
          description: "마감일 (YYYY-MM-DD)"
        preferredCondition:
          type: string
          description: "우대조건 (e.g. 경력 3년 이상)"
        salaryRange:
          type: string
          enum: [UNDER_2400, RANGE_2400_3000, RANGE_3000_3600, RANGE_3600_4200, RANGE_4200_5000, OVER_5000]
          description: 급여 조건 (범위 선택)
        salaryDescription:
          type: string
          description: "급여 조건 텍스트 (e.g. 면접 후 결정 (회사 내규에 따름))"
        location:
          type: string
          description: "근무지 (e.g. 광화문)"
        workStart:
          type: string
          description: "출근 시간 (HH:mm, e.g. 09:00)"
        workEnd:
          type: string
          description: "퇴근 시간 (HH:mm, e.g. 18:00)"
        applicationUrl:
          type: string
          format: uri
          description: "지원 링크 바로가기 URL"
        aiEvalCredential:
          type: boolean
          default: false
          description: "AI 정량 평가 — 자격증/어학 (정량 점수화)"
        aiEvalExperience:
          type: boolean
          default: false
          description: "AI 정량 평가 — 대외/해외경험 (경험 가점)"
        aiEvalAward:
          type: boolean
          default: false
          description: "AI 정량 평가 — 수상 내역 (직무 연관성)"
        skills:
          type: array
          items: { type: string }
          description: 요구 기술 스택

    JobPostingListItem:
      type: object
      properties:
        id: { type: string }
        title: { type: string }
        status: { type: string, enum: [OPEN, CLOSED] }
        deadline: { type: string, format: date-time, nullable: true }
        preferredCondition: { type: string, nullable: true }
        salaryRange:
          type: string
          enum: [UNDER_2400, RANGE_2400_3000, RANGE_3000_3600, RANGE_3600_4200, RANGE_4200_5000, OVER_5000]
          nullable: true
        salaryDescription: { type: string, nullable: true, description: "급여 조건 텍스트" }
        location: { type: string, nullable: true }
        workStart: { type: string, nullable: true }
        workEnd: { type: string, nullable: true }
        matchRate:
          type: integer
          nullable: true
          description: "매칭률 (인증된 취준생인 경우, 0~100)"
        createdAt: { type: string, format: date-time }
        corporation:
          type: object
          properties:
            id: { type: string }
            name: { type: string }
            description: { type: string, nullable: true }
            thumbnailUrl: { type: string, nullable: true }
            tags:
              type: array
              items: { type: string }
              description: "기업 태그 (e.g. 핀테크, 유니콘, 시리즈D)"

    JobPostingDetail:
      type: object
      properties:
        id: { type: string }
        title: { type: string }
        jobTrack: { type: string }
        status: { type: string, enum: [OPEN, CLOSED] }
        minEducationLevel:
          type: string
          enum: [HIGH_SCHOOL, ASSOCIATE, BACHELOR, MASTER, DOCTORATE]
        militaryPolicy:
          type: string
          enum: [NOT_RELEVANT, REQUIRED, BONUS, NOT_REFLECTED]
        careerPolicy:
          type: string
          enum: [NOT_RELEVANT, REQUIRED, BONUS, NOT_REFLECTED]
        deadline: { type: string, format: date-time, nullable: true }
        preferredCondition: { type: string, nullable: true }
        salaryRange:
          type: string
          enum: [UNDER_2400, RANGE_2400_3000, RANGE_3000_3600, RANGE_3600_4200, RANGE_4200_5000, OVER_5000]
          nullable: true
        salaryDescription: { type: string, nullable: true, description: "급여 조건 텍스트" }
        location: { type: string, nullable: true }
        workStart: { type: string, nullable: true }
        workEnd: { type: string, nullable: true }
        applicationUrl: { type: string, nullable: true }
        aiEvalCredential: { type: boolean }
        aiEvalExperience: { type: boolean }
        aiEvalAward: { type: boolean }
        skills:
          type: array
          items: { type: string }
        matchRate:
          type: integer
          nullable: true
          description: "매칭률 (인증된 취준생인 경우)"
        createdAt: { type: string, format: date-time }
        updatedAt: { type: string, format: date-time }
        corporation:
          type: object
          properties:
            id: { type: string }
            name: { type: string }
            description: { type: string, nullable: true }
            thumbnailUrl: { type: string, nullable: true }
            industry: { type: string }
            address: { type: string }
            companySize:
              type: string
              enum: [STARTUP, SMALL, MEDIUM, LARGE, ENTERPRISE]
            homepageUrl: { type: string, nullable: true }
            tags:
              type: array
              items: { type: string }

    Pagination:
      type: object
      properties:
        page: { type: integer }
        limit: { type: integer }
        total: { type: integer }
        totalPages: { type: integer }

  responses:
    Unauthorized:
      description: 로그인 필요
      content:
        application/json:
          schema: { $ref: "#/components/schemas/Error" }
          example:
            error: { code: UNAUTHORIZED, message: "로그인이 필요합니다." }
    UserNotFound:
      description: 사용자 없음
      content:
        application/json:
          schema: { $ref: "#/components/schemas/Error" }
    ValidationError:
      description: 입력값 오류
      content:
        application/json:
          schema: { $ref: "#/components/schemas/Error" }
          example:
            error: { code: VALIDATION_ERROR, message: "입력값이 올바르지 않습니다." }
    DBError:
      description: DB 오류
      content:
        application/json:
          schema: { $ref: "#/components/schemas/Error" }
          example:
            error: { code: DB_ERROR, message: "데이터베이스 오류가 발생했습니다." }
