generator client {
  provider = "prisma-client"
  output   = "./generated/prisma"
}

datasource db {
  provider = "postgresql"
}

// ──────────────────────────────────────
// Enums
// ──────────────────────────────────────

enum UserRole {
  JOB_SEEKER
  CORPORATION
}

enum EducationLevel {
  HIGH_SCHOOL
  ASSOCIATE
  BACHELOR
  MASTER
  DOCTORATE
}

enum MilitaryStatus {
  NOT_APPLICABLE
  COMPLETED
  EXEMPT
  SERVING
  NOT_COMPLETED
}

enum EmploymentType {
  FULL_TIME
  CONTRACT
  INTERN
  FREELANCE
}

enum Gender {
  MALE
  FEMALE
  OTHER
}

enum ExperienceType {
  ACTIVITY
  AWARD
  OVERSEAS
  VOLUNTEER
}

enum CredentialType {
  CERTIFICATE
  LANGUAGE
}

enum DocumentType {
  CAREER
  PROJECT
}

enum CompanySize {
  STARTUP
  SMALL
  MEDIUM
  LARGE
  ENTERPRISE
}

enum SalaryRange {
  UNDER_2400
  RANGE_2400_3000
  RANGE_3000_3600
  RANGE_3600_4200
  RANGE_4200_5000
  OVER_5000
}

// 채용 공고 상태
enum PostingStatus {
  OPEN   // 채용 중
  CLOSED // 마감
}

// 브랜딩 카드 상태
enum BrandingCardStatus {
  DRAFT     // AI 생성 후 미공개
  PUBLISHED // 최종 저장 및 공개
}

// 필터 정책 (병역 여부 / 직무 관련 경력에 공통 사용)
enum FilterPolicy {
  NOT_RELEVANT  // 무관
  REQUIRED      // 필수
  BONUS         // 가산점 부여
  NOT_REFLECTED // 미반영
}

// ──────────────────────────────────────
// 인증 (NextAuth)
// ──────────────────────────────────────

// 사용자 (인증/계정 단위)
model User {
  id            String    @id @default(cuid())
  name          String?
  email         String?   @unique
  emailVerified DateTime?
  image         String?
  role          UserRole?

  accounts    Account[]
  userProfile UserProfile?
  corporation Corporation?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// OAuth 계정 연동 (Google)
model Account {
  id                String  @id @default(cuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String? @db.Text
  access_token      String? @db.Text
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String? @db.Text
  session_state     String?

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([provider, providerAccountId])
}

// ──────────────────────────────────────
// 취준생 도메인
// ──────────────────────────────────────

// 취준생 프로필 (매칭 핵심 테이블)
model UserProfile {
  id     String @id @default(cuid())
  userId String @unique
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  // Hard Filter
  educationLevel EducationLevel
  major          String
  desiredJobRole String
  militaryStatus MilitaryStatus

  // 선호 조건
  desiredLocation    String?
  desiredSalaryRange SalaryRange?
  commuteStart       String? // "HH:mm"
  commuteEnd         String? // "HH:mm"
  employmentType     EmploymentType?

  // 기본 정보
  birthDate DateTime
  gender    Gender

  // 서브 테이블
  skills      UserSkill[]
  experiences UserExperience[]
  credentials UserCredential[]
  documents   UserDocument[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// 기술 스택
model UserSkill {
  id            String      @id @default(cuid())
  userProfileId String
  userProfile   UserProfile @relation(fields: [userProfileId], references: [id], onDelete: Cascade)

  skillName String
}

// 경험/수상/활동
model UserExperience {
  id            String      @id @default(cuid())
  userProfileId String
  userProfile   UserProfile @relation(fields: [userProfileId], references: [id], onDelete: Cascade)

  type         ExperienceType
  title        String
  description  String?
  isJobRelated Boolean        @default(false)
}

// 자격증 / 어학
model UserCredential {
  id            String      @id @default(cuid())
  userProfileId String
  userProfile   UserProfile @relation(fields: [userProfileId], references: [id], onDelete: Cascade)

  type  CredentialType
  name  String
  score String?
}

// 첨부 문서 (매칭 제외, 프로필 신뢰도용)
model UserDocument {
  id            String      @id @default(cuid())
  userProfileId String
  userProfile   UserProfile @relation(fields: [userProfileId], references: [id], onDelete: Cascade)

  type    DocumentType
  fileUrl String
}

// ──────────────────────────────────────
// 기업 도메인
// ──────────────────────────────────────

// 기업 기본 정보
model Corporation {
  id     String @id @default(cuid())
  userId String @unique
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  name         String
  thumbnailUrl String?
  industry     String
  address      String
  description  String?
  welfare      String?
  homepageUrl  String?
  companySize  CompanySize
  phone        String?

  tags         CompanyTag[]
  jobPostings  JobPosting[]
  brandingCard BrandingCard?

  createdAt DateTime @default(now())
}

// 기업 태그 (핀테크, 유니콘 등)
model CompanyTag {
  id            String      @id @default(cuid())
  corporationId String
  corporation   Corporation @relation(fields: [corporationId], references: [id], onDelete: Cascade)

  tagName String
}

// ──────────────────────────────────────
// 공고 (매칭 중심 테이블)
// ──────────────────────────────────────

// 채용 공고
model JobPosting {
  id            String      @id @default(cuid())
  corporationId String
  corporation   Corporation @relation(fields: [corporationId], references: [id], onDelete: Cascade)

  // 공고 기본 정보
  title    String        // 뽑는 직무 (e.g. "Front-end Engineer")
  jobTrack String        // 직무 트랙 (e.g. "기술/개발 트랙")
  status   PostingStatus @default(OPEN) // 채용 상태

  // Hard Filter (필수 요건)
  minEducationLevel  EducationLevel   // 필수 학력 요건
  militaryPolicy     FilterPolicy @default(NOT_RELEVANT) // 병역 여부
  careerPolicy       FilterPolicy @default(NOT_RELEVANT) // 직무 관련 경력

  // 조건
  deadline           DateTime?    // 마감일
  preferredCondition String?      // 우대조건 (e.g. "경력 3년 이상")
  salaryRange        SalaryRange? // 급여 조건 (범위 선택)
  salaryDescription  String?      // 급여 조건 텍스트 (e.g. "면접 후 결정 (회사 내규에 따름)")
  location           String?      // 근무지
  workStart          String?      // 출근 시간 "HH:mm"
  workEnd            String?      // 퇴근 시간 "HH:mm"
  applicationUrl     String?      // 지원 링크 바로가기 URL

  // AI 정량 평가 항목 (활성화 여부)
  aiEvalCredential Boolean @default(false) // 자격증/어학 → 정량 점수화
  aiEvalExperience Boolean @default(false) // 대외/해외경험 → 경험 가점
  aiEvalAward      Boolean @default(false) // 수상 내역 → 직무 연관성

  skills JobSkill[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// 공고별 요구 기술
model JobSkill {
  id           String     @id @default(cuid())
  jobPostingId String
  jobPosting   JobPosting @relation(fields: [jobPostingId], references: [id], onDelete: Cascade)

  skillName String
}

// ──────────────────────────────────────
// AI 브랜딩 카드
// ──────────────────────────────────────

// 기업 브랜딩 카드 (기업당 1개)
model BrandingCard {
  id            String      @id @default(cuid())
  corporationId String      @unique
  corporation   Corporation @relation(fields: [corporationId], references: [id], onDelete: Cascade)

  // AI 생성 콘텐츠 (편집 가능)
  catchphrase String  // 메인 슬로건 (최대 40자)
  description String  // 기업 한 줄 소개 (최대 100자)

  // 배경 스타일
  backgroundStyle String @default("navy") // navy, green, purple, black, custom
  backgroundUrl   String? // 커스텀 배경 이미지 URL

  // 썸네일 이미지
  thumbnailUrl    String? // AI 생성 또는 업로드
  thumbnailSource String  @default("file") // "file" | "ai"

  // 메타
  status BrandingCardStatus @default(DRAFT)
  prompt String?  // 사용자가 입력한 프롬프트 (재생성 시 참고)

  keywords BrandingKeyword[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// 브랜딩 카드 키워드 해시태그
model BrandingKeyword {
  id             String       @id @default(cuid())
  brandingCardId String
  brandingCard   BrandingCard @relation(fields: [brandingCardId], references: [id], onDelete: Cascade)

  keyword String // e.g. "자율출퇴근", "무제한식대"
}

// ──────────────────────────────────────
// 매칭
// ──────────────────────────────────────

// 매칭 결과 (캐시/저장용)
model MatchingResult {
  id            String @id @default(cuid())
  userProfileId String
  jobPostingId  String

  score  Int
  reason String? // AI 생성 추천 이유

  createdAt DateTime @default(now())

  @@unique([userProfileId, jobPostingId])
}
